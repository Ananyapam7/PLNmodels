<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyzing multivariate count table with the Poisson log-normal model â€¢ PLNmodels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing multivariate count table with the Poisson log-normal model">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PLNmodels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/article/PLNmodels.html">Article</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/PLN.html">PLN: Multivariate Poisson regression</a>
    </li>
    <li>
      <a href="../articles/PLNPCA.html">PLNPCA: Dimension Reduction</a>
    </li>
    <li>
      <a href="../articles/PLNLDA.html">PLNLDA: Discriminant Analysis</a>
    </li>
    <li>
      <a href="../articles/PLNnetwork.html">PLNnetwork: sparse structure inference</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jchiquet/PLNmodels">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Analyzing multivariate count table with the Poisson log-normal model</h1>
                        <h4 class="author">PLN team</h4>
            
            <h4 class="date">2018-12-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jchiquet/PLNmodels/blob/master/vignettes/PLN.Rmd"><code>vignettes/PLN.Rmd</code></a></small>
      <div class="hidden name"><code>PLN.Rmd</code></div>

    </div>

    
    
<p>This vignette illustrates the use of the <code>PLN</code> function and the methods accompaning the R6 class <code>PLNfit</code>. From the statistical point of view, the function <code>PLN</code> adjusts a multivariate Poisson lognormal model to a table of counts. <code>PLN</code> is the building block for all the multivariate models found in the <code>PLNmodels</code> package: having a basic understanding of both the mathematical background and the associated set of <code>R</code> functions is good place to start.</p>
<p>We will illustrate our point with an ecological data set concerning abundances of Trichopetera species, coupled with some meteological factors that may influence the presence their presence.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(PLNmodels)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(trichoptera)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">grouping &lt;-<span class="st"> </span>trichoptera<span class="op">$</span>Group</a></code></pre></div>
<p>Mathematical background and a full description of the trichoptera data set can be found in <a href="PLNmodels_introduction.html">the introductory vignette</a>.</p>
<div id="a-pln-model-with-latent-main-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#a-pln-model-with-latent-main-effects" class="anchor"></a>A PLN model with latent main effects</h3>
<p>The model can be fitted with the function <code>PLN</code> as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">myPLN &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PLN.html">PLN</a></span>(Abundance <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/offset">offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(TotalCounts)), trichoptera)</a></code></pre></div>
<pre><code>## 
##  Initialization...
##  Adjusting a PLN model with full covariance model
##  Post-treatments...
##  DONE!</code></pre>
<p>Note the use of the <code>formula</code> object to specify the model: the vector <span class="math inline">\(\boldsymbol\mu\)</span> of main effects in the mathematical formulation (one per column species) is specified in the call with the formula <code>~ 1</code>. We use the function offset with a log transform of the total count. Abundace is a variable in ther data frame <code>trichoptera</code> correspondings to a matrix of 17 columns.</p>
<p><code>myPLN</code> is an <code>R6</code> object with class <code>PLNfit</code>, which comes with a couple of methods, as recalled when printing such an object:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">myPLN</a></code></pre></div>
<pre><code>## A multivariate Poisson Lognormal fit with full covariance model.
## ==================================================================
##  degrees_freedom    loglik       BIC       ICL R_squared
##              170 -1051.523 -1382.327 -2205.476 0.9221581
## ==================================================================
## * Useful fields 
##     $model_par, $fitted, $latent, $var_par, $optim_par 
##     $loglik, $BIC, $ICL, $loglik_vec, $degrees_freedom, $criteria 
## * Useful S3 methods
##     print(), vcov(), coef(), predict()</code></pre>
<div id="field-access-to-a-pln-output" class="section level4">
<h4 class="hasAnchor">
<a href="#field-access-to-a-pln-output" class="anchor"></a>Field access to a PLN output</h4>
<p>Let us try to access the most common fields:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">myPLN<span class="op">$</span>loglik</a></code></pre></div>
<pre><code>## [1] -1051.523</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">myPLN<span class="op">$</span>BIC</a></code></pre></div>
<pre><code>## [1] -1382.327</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">myPLN<span class="op">$</span>ICL</a></code></pre></div>
<pre><code>## [1] -2205.476</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">myPLN<span class="op">$</span>R_squared</a></code></pre></div>
<pre><code>## [1] 0.9221581</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">myPLN<span class="op">$</span>criteria</a></code></pre></div>
<pre><code>## degrees_freedom          loglik             BIC             ICL 
##     170.0000000   -1051.5226431   -1382.3273685   -2205.4759919 
##       R_squared 
##       0.9221581</code></pre>
<p>We can also reach the matrix of regression parameters and the variance/covariance matrix of the latent variable <span class="math inline">\(Z\)</span> with the traditional function found in <code>R</code> for (g)lm manipulation:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(myPLN))</a></code></pre></div>
<pre><code>##     (Intercept)
## Che  -8.1771636
## Hyc  -8.2720330
## Hym  -2.9790535
## Hys  -7.0826553
## Psy  -0.5471443
## Aga  -4.0920004</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/vcov">vcov</a></span>(myPLN))</a></code></pre></div>
<pre><code>##              Che          Hyc        Hym        Hys          Psy
## Che  2.526943821 -0.008766847  0.3603101  0.4448887 -0.017850341
## Hyc -0.008766847  1.902243345  0.1124342  0.2715021 -0.146502283
## Hym  0.360310110  0.112434233  1.2449163  0.8655075 -0.118961495
## Hys  0.444888729  0.271502063  0.8655075  2.6625654 -0.147169999
## Psy -0.017850341 -0.146502283 -0.1189615 -0.1471700  0.076295612
## Aga  0.309093537 -0.132641681  0.5132070  0.4248568  0.001717414
##              Aga         Glo         Ath           Cea         Ced
## Che  0.309093537  0.08953427  0.35228473 -0.0096483095  0.33794406
## Hyc -0.132641681  0.17176875  0.11180019  0.0055988760  0.22269439
## Hym  0.513207009  0.20984215  0.38574277 -0.0219839180  0.50831046
## Hys  0.424856789  0.34248317  0.60821330 -0.0166596205  0.68165077
## Psy  0.001717414 -0.05013468 -0.04855131  0.0002951239 -0.09855308
## Aga  1.105061747 -0.06445872  0.19666849 -0.0229611075  0.21827286
##             Set          All        Han        Hfo        Hsp         Hve
## Che -0.05824348  0.272202604 -0.1830943 -0.3634547 -0.4416038  0.31293725
## Hyc  0.47595629 -0.263369260  0.6242441  0.5588998  0.6708982 -0.13148839
## Hym -0.18107123  0.680608021  0.2121454 -0.3947503 -0.3308211  0.16050977
## Hys  0.13911592  0.369005057  0.1394216 -0.1844264 -0.1739328  0.24085875
## Psy -0.09155024 -0.004547741 -0.2886519 -0.1457209 -0.1916850  0.04573374
## Aga -0.30242347  0.594343491 -0.1729006 -0.8149132 -0.7806315  0.18710566
##            Sta
## Che  0.3641102
## Hyc  0.2566928
## Hym  0.4788411
## Hys  0.6151163
## Psy -0.1214902
## Aga  0.4401105</code></pre>
<p>Consider plotting the parameters with the nice <code>corrplot</code> package, <em>e.g.</em> the the covariance matrix:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">corrplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/corrplot/topics/corrplot">corrplot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/vcov">vcov</a></span>(myPLN), <span class="dt">is.corr =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="PLN_files/figure-html/plot%20covariance-1.png" width="672"></p>
</div>
<div id="observation-weights" class="section level4">
<h4 class="hasAnchor">
<a href="#observation-weights" class="anchor"></a>Observation weights</h4>
<p>It is also possible to use observation weights like in standard (generalized) linear models:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">myPLN_weighted &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PLN.html">PLN</a></span>(Abundance <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/offset">offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(TotalCounts)), <span class="dt">data =</span> trichoptera, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(trichoptera)))</a></code></pre></div>
<pre><code>## 
##  Initialization...
##  Adjusting a PLN model with full covariance model (with observation weigths)
##  Post-treatments...
##  DONE!</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">corrplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/corrplot/topics/corrplot">corrplot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/vcov">vcov</a></span>(myPLN) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/vcov">vcov</a></span>(myPLN_weighted), <span class="dt">is.corr =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="PLN_files/figure-html/weighted-1.png" width="672"></p>
</div>
<div id="make-prediction-with-new-data" class="section level4">
<h4 class="hasAnchor">
<a href="#make-prediction-with-new-data" class="anchor"></a>Make prediction with new data</h4>
<p>The prediction method can be use to predict new responses from a new table of data (with both covariates and offset if needed.)</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">newdata &lt;-<span class="st"> </span>trichoptera[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ]</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">newdata<span class="op">$</span>Abundance &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(myPLN, <span class="dt">newdata =</span> newdata, <span class="dt">type =</span> <span class="st">"response"</span>)</a></code></pre></div>
<pre><code>##            Che         Hyc        Hym        Hys        Psy       Aga
## 1  0.028828355 0.019185212  2.7475250 0.09217404  17.431856 0.8418329
## 2  0.012923056 0.008600267  1.2316491 0.04131940   7.814280 0.3773734
## 3  0.037775086 0.025139243  3.6002051 0.12077977  22.841742 1.1030914
## 4  0.190863593 0.127019332 18.1905101 0.61025569 115.410908 5.5735144
## 5  0.078532416 0.052263163  7.4846370 0.25109479  47.486780 2.2932690
## 6  0.017893462 0.011908062  1.7053603 0.05721147  10.819773 0.5225170
## 7  0.007952650 0.005292472  0.7579379 0.02542732   4.808788 0.2322298
## 8  0.033798761 0.022493007  3.2212362 0.10806611  20.437348 0.9869765
## 9  0.011928975 0.007938708  1.1369069 0.03814098   7.213182 0.3483447
## 10 0.003976325 0.002646236  0.3789690 0.01271366   2.404394 0.1161149
##           Glo        Ath         Cea       Ced       Set        All
## 1  0.08963347 0.13677981 0.024717549 1.2331079 0.7870233 0.52074486
## 2  0.04018052 0.06131509 0.011080281 0.5527725 0.3528035 0.23343735
## 3  0.11745075 0.17922872 0.032388513 1.6157965 1.0312719 0.68235534
## 4  0.59343537 0.90557670 0.163647224 8.1640245 5.2106367 3.44769012
## 5  0.24417393 0.37260708 0.067334014 3.3591559 2.1439599 1.41858083
## 6  0.05563457 0.08489782 0.015341927 0.7653773 0.4884972 0.32322095
## 7  0.02472647 0.03773236 0.006818634 0.3401677 0.2171099 0.14365376
## 8  0.10508751 0.16036254 0.028979196 1.4457127 0.9227169 0.61052846
## 9  0.03708971 0.05659854 0.010227951 0.5102515 0.3256648 0.21548063
## 10 0.01236324 0.01886618 0.003409317 0.1700838 0.1085549 0.07182688
##          Han        Hfo       Hsp         Hve        Sta
## 1  1.4583620 0.24466857 1.5011180 0.060303258  2.7174382
## 2  0.6537485 0.10967901 0.6729150 0.027032495  1.2181619
## 3  1.9109571 0.32060019 1.9669822 0.079018062  3.5607810
## 4  9.6553623 1.61987466 9.9384365 0.399249158 17.9913148
## 5  3.9727793 0.66651093 4.0892525 0.164274393  7.4026764
## 6  0.9051902 0.15186325 0.9317284 0.037429609  1.6866858
## 7  0.4023068 0.06749478 0.4141015 0.016635382  0.7496381
## 8  1.7098037 0.28685280 1.7599315 0.070700372  3.1859620
## 9  0.6034601 0.10124217 0.6211523 0.024953072  1.1244572
## 10 0.2011534 0.03374739 0.2070508 0.008317691  0.3748191
## attr(,"type")
## [1] "response"</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Julien Chiquet, Mahendra Mariadassou.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
